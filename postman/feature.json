{
	"info": {
		"_postman_id": "8446fd0a-8d33-44f7-b89c-1f2ab02e679c",
		"name": "feature_comments",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "46904690"
	},
	"item": [
		{
			"name": "Создание пользователя",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const jsonData = pm.response.json();",
							"pm.environment.set(\"userId\", jsonData.id);",
							"",
							"pm.test(\"Ответ должен содержать код статуса 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';",
							"let r = '';",
							"for (let i = 0; i < 7; i++) {",
							"    r += chars.charAt(Math.floor(Math.random() * chars.length));",
							"}",
							"pm.environment.set('random_name', r);",
							"pm.environment.set('random_email', `user_${r}@test.com`);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"{{random_name}}\",\"email\":\"{{random_email}}\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/admin/users",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"admin",
						"users"
					]
				}
			},
			"response": []
		},
		{
			"name": "Создание категории",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const jsonData = pm.response.json();",
							"pm.environment.set(\"catId\", jsonData.id);",
							"",
							"pm.test(\"Ответ должен содержать код статуса 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});"
						],
						"type": "text/javascript"
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';",
							"let r = '';",
							"for (let i = 0; i < 7; i++) {",
							"    r += chars.charAt(Math.floor(Math.random() * chars.length));",
							"}",
							"pm.environment.set('random_cat', r);"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"name\":\"{{random_cat}}\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/admin/categories",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"admin",
						"categories"
					]
				}
			},
			"response": []
		},
		{
			"name": "Создание мероприятия",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const jsonData = pm.response.json();",
							"pm.environment.set(\"publishedEventId\", jsonData.id);",
							"",
							"pm.test(\"Ответ должен содержать код статуса 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"annotation\":\"Тестовое событие для комментариев\",\n\"category\":{{catId}},\n\"description\":\"Описание тестового события для проверки комментариев\",\n\"eventDate\":\"2025-12-31 20:00:00\",\n\"location\":{\"lat\":55.7558,\"lon\":37.6176},\n\"paid\":false,\n\"participantLimit\":100,\n\"requestModeration\":false,\n\"title\":\"Тестовое событие\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/users/{{userId}}/events",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"{{userId}}",
						"events"
					]
				}
			},
			"response": []
		},
		{
			"name": "Публикация события",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Событие опубликовано - статус 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "PATCH",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"stateAction\":\"PUBLISH_EVENT\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/admin/events/{{publishedEventId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"admin",
						"events",
						"{{publishedEventId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Создание комментария",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const jsonData = pm.response.json();",
							"pm.environment.set(\"commentId\", jsonData.id);",
							"",
							"pm.test(\"Комментарий создан - статус 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});",
							"",
							"pm.test(\"Ответ содержит корректные поля\", function () {",
							"    pm.expect(jsonData).to.have.property('id');",
							"    pm.expect(jsonData).to.have.property('text');",
							"    pm.expect(jsonData).to.have.property('author');",
							"    pm.expect(jsonData).to.have.property('event');",
							"    pm.expect(jsonData).to.have.property('created');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"text\":\"Отличное мероприятие!\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/users/{{userId}}/events/{{publishedEventId}}/comments",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"{{userId}}",
						"events",
						"{{publishedEventId}}",
						"comments"
					]
				}
			},
			"response": []
		},
		{
			"name": "Получение комментариев",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Комментарии получены - статус 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"const jsonData = pm.response.json();",
							"const commentId = pm.environment.get('commentId');",
							"",
							"pm.test(\"Ответ является массивом\", function () {",
							"    pm.expect(jsonData).to.be.an('array');",
							"});",
							"",
							"pm.test(\"Массив содержит созданный комментарий\", function () {",
							"    const found = jsonData.some(comment => comment.id === Number(commentId));",
							"    pm.expect(found).to.be.true;",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/events/{{publishedEventId}}/comments",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"events",
						"{{publishedEventId}}",
						"comments"
					]
				}
			},
			"response": []
		},
		{
			"name": "Валидация: пустой текст комментария",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Пустой текст - статус 400\", function () {",
							"    pm.response.to.have.status(400);",
							"});",
							"",
							"const jsonData = pm.response.json();",
							"pm.test(\"Содержит сообщение об ошибке\", function () {",
							"    pm.expect(jsonData).to.have.property('message');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"text\":\"\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/users/{{userId}}/events/{{publishedEventId}}/comments",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"{{userId}}",
						"events",
						"{{publishedEventId}}",
						"comments"
					]
				}
			},
			"response": []
		},
		{
			"name": "Валидация: слишком длинный текст",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Слишком длинный текст - статус 400\", function () {",
							"    pm.response.to.have.status(400);",
							"});",
							"",
							"const jsonData = pm.response.json();",
							"pm.test(\"Содержит сообщение о длине\", function () {",
							"    pm.expect(jsonData).to.have.property('message');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				},
				{
					"listen": "prerequest",
					"script": {
						"exec": [
							"let longText = '';",
							"for (let i = 0; i < 2001; i++) {",
							"    longText += 'a';",
							"}",
							"pm.environment.set('long_text', longText);"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"text\":\"{{long_text}}\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/users/{{userId}}/events/{{publishedEventId}}/comments",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"{{userId}}",
						"events",
						"{{publishedEventId}}",
						"comments"
					]
				}
			},
			"response": []
		},
		{
			"name": "Создание неопубликованного события",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"const jsonData = pm.response.json();",
							"pm.environment.set(\"unpublishedEventId\", jsonData.id);",
							"",
							"pm.test(\"Неопубликованное событие создано - статус 201\", function () {",
							"    pm.response.to.have.status(201);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"annotation\":\"Неопубликованное событие\",\n\"category\":{{catId}},\n\"description\":\"Событие в состоянии PENDING\",\n\"eventDate\":\"2025-12-31 21:00:00\",\n\"location\":{\"lat\":55.7558,\"lon\":37.6176},\n\"paid\":false,\n\"participantLimit\":50,\n\"requestModeration\":false,\n\"title\":\"Неопубликованное событие\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/users/{{userId}}/events",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"{{userId}}",
						"events"
					]
				}
			},
			"response": []
		},
		{
			"name": "Комментарий для неопубликованного события",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Неопубликованное событие - статус 409\", function () {",
							"    pm.response.to.have.status(409);",
							"});",
							"",
							"const jsonData = pm.response.json();",
							"pm.test(\"Содержит сообщение о конфликте\", function () {",
							"    pm.expect(jsonData).to.have.property('message');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [],
				"body": {
					"mode": "raw",
					"raw": "{\"text\":\"Комментарий для неопубликованного события\"}",
					"options": {
						"raw": {
							"language": "json"
						}
					}
				},
				"url": {
					"raw": "{{baseUrl}}/users/{{userId}}/events/{{unpublishedEventId}}/comments",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"users",
						"{{userId}}",
						"events",
						"{{unpublishedEventId}}",
						"comments"
					]
				}
			},
			"response": []
		},
		{
			"name": "Удаление комментария администратором",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Комментарий удален - статус 204\", function () {",
							"    pm.response.to.have.status(204);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/admin/comments/{{commentId}}",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"admin",
						"comments",
						"{{commentId}}"
					]
				}
			},
			"response": []
		},
		{
			"name": "Проверка удаления комментария",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Комментарии получены - статус 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"const jsonData = pm.response.json();",
							"const commentId = pm.environment.get('commentId');",
							"",
							"pm.test(\"Удаленный комментарий отсутствует в списке\", function () {",
							"    const found = jsonData.some(comment => comment.id === Number(commentId));",
							"    pm.expect(found).to.be.false;",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/events/{{publishedEventId}}/comments",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"events",
						"{{publishedEventId}}",
						"comments"
					]
				}
			},
			"response": []
		},
		{
			"name": "Удаление несуществующего комментария",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Несуществующий комментарий - статус 404\", function () {",
							"    pm.response.to.have.status(404);",
							"});",
							"",
							"const jsonData = pm.response.json();",
							"pm.test(\"Содержит сообщение об ошибке\", function () {",
							"    pm.expect(jsonData).to.have.property('message');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "DELETE",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/admin/comments/999999",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"admin",
						"comments",
						"999999"
					]
				}
			},
			"response": []
		},
		{
			"name": "Получение комментариев для несуществующего события",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Несуществующее событие - статус 404\", function () {",
							"    pm.response.to.have.status(404);",
							"});",
							"",
							"const jsonData = pm.response.json();",
							"pm.test(\"Содержит сообщение об ошибке\", function () {",
							"    pm.expect(jsonData).to.have.property('message');",
							"});"
						],
						"type": "text/javascript",
						"packages": {},
						"requests": {}
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{baseUrl}}/events/999999/comments",
					"host": [
						"{{baseUrl}}"
					],
					"path": [
						"events",
						"999999",
						"comments"
					]
				}
			},
			"response": []
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl",
			"value": "http://localhost:8080"
		},
		{
			"key": "userId",
			"value": ""
		},
		{
			"key": "catId",
			"value": ""
		},
		{
			"key": "publishedEventId",
			"value": ""
		},
		{
			"key": "unpublishedEventId",
			"value": ""
		},
		{
			"key": "commentId",
			"value": ""
		},
		{
			"key": "random_name",
			"value": ""
		},
		{
			"key": "random_email",
			"value": ""
		},
		{
			"key": "random_cat",
			"value": ""
		},
		{
			"key": "long_text",
			"value": ""
		}
	]
}